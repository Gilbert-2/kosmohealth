<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download Face-API.js Models</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #333;
      text-align: center;
    }
    .progress {
      margin: 20px 0;
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 4px;
    }
    .model-list {
      margin: 20px 0;
    }
    .model-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      background-color: #f9f9f9;
      border-radius: 4px;
    }
    .model-name {
      flex: 1;
    }
    .model-status {
      margin-left: 10px;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }
    .status-pending {
      background-color: #f0f0f0;
      color: #666;
    }
    .status-downloading {
      background-color: #fff3cd;
      color: #856404;
    }
    .status-success {
      background-color: #d4edda;
      color: #155724;
    }
    .status-error {
      background-color: #f8d7da;
      color: #721c24;
    }
    .button {
      display: block;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
    }
    .button:hover {
      background-color: #0069d9;
    }
    .button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    .instructions {
      margin-top: 20px;
      padding: 15px;
      background-color: #e9f5ff;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Download Face-API.js Models</h1>
    
    <div class="progress">
      <div id="progressText">Ready to download models...</div>
    </div>
    
    <div class="model-list" id="modelList">
      <!-- Model items will be added here -->
    </div>
    
    <button id="downloadButton" class="button">Download All Models</button>
    
    <div class="instructions">
      <h3>Instructions:</h3>
      <ol>
        <li>Click the "Download All Models" button to start downloading the models.</li>
        <li>Each model will be downloaded one by one.</li>
        <li>Once all models are downloaded, you can close this page.</li>
        <li>The models will be saved in the <code>public/js/face-api-models</code> directory.</li>
      </ol>
    </div>
  </div>
  
  <script>
    // Model definitions
    const models = [
      {
        name: 'Tiny Face Detector (Manifest)',
        filename: 'tiny_face_detector_model-weights_manifest.json',
        url: 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/tiny_face_detector_model-weights_manifest.json',
        status: 'pending'
      },
      {
        name: 'Tiny Face Detector (Shard 1)',
        filename: 'tiny_face_detector_model-shard1',
        url: 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/tiny_face_detector_model-shard1',
        status: 'pending'
      },
      {
        name: 'Face Landmark 68 (Manifest)',
        filename: 'face_landmark_68_model-weights_manifest.json',
        url: 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/face_landmark_68_model-weights_manifest.json',
        status: 'pending'
      },
      {
        name: 'Face Landmark 68 (Shard 1)',
        filename: 'face_landmark_68_model-shard1',
        url: 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/face_landmark_68_model-shard1',
        status: 'pending'
      },
      {
        name: 'Face Recognition (Manifest)',
        filename: 'face_recognition_model-weights_manifest.json',
        url: 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/face_recognition_model-weights_manifest.json',
        status: 'pending'
      },
      {
        name: 'Face Recognition (Shard 1)',
        filename: 'face_recognition_model-shard1',
        url: 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/face_recognition_model-shard1',
        status: 'pending'
      },
      {
        name: 'Face Recognition (Shard 2)',
        filename: 'face_recognition_model-shard2',
        url: 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/face_recognition_model-shard2',
        status: 'pending'
      },
      {
        name: 'Face Expression (Manifest)',
        filename: 'face_expression_model-weights_manifest.json',
        url: 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/face_expression_model-weights_manifest.json',
        status: 'pending'
      },
      {
        name: 'Face Expression (Shard 1)',
        filename: 'face_expression_model-shard1',
        url: 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights/face_expression_model-shard1',
        status: 'pending'
      }
    ];
    
    // DOM elements
    const modelList = document.getElementById('modelList');
    const progressText = document.getElementById('progressText');
    const downloadButton = document.getElementById('downloadButton');
    
    // Initialize model list
    function initModelList() {
      modelList.innerHTML = '';
      
      models.forEach((model, index) => {
        const modelItem = document.createElement('div');
        modelItem.className = 'model-item';
        modelItem.id = `model-${index}`;
        
        const modelName = document.createElement('div');
        modelName.className = 'model-name';
        modelName.textContent = model.name;
        
        const modelStatus = document.createElement('div');
        modelStatus.className = 'model-status status-pending';
        modelStatus.id = `status-${index}`;
        modelStatus.textContent = 'Pending';
        
        modelItem.appendChild(modelName);
        modelItem.appendChild(modelStatus);
        modelList.appendChild(modelItem);
      });
    }
    
    // Download a single model
    async function downloadModel(model, index) {
      try {
        // Update status
        const statusElement = document.getElementById(`status-${index}`);
        statusElement.className = 'model-status status-downloading';
        statusElement.textContent = 'Downloading...';
        
        // Fetch the model
        const response = await fetch(model.url);
        const blob = await response.blob();
        
        // Create a download link
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = model.filename;
        link.click();
        
        // Update status
        model.status = 'success';
        statusElement.className = 'model-status status-success';
        statusElement.textContent = 'Downloaded';
        
        return true;
      } catch (error) {
        console.error(`Error downloading ${model.name}:`, error);
        
        // Update status
        model.status = 'error';
        const statusElement = document.getElementById(`status-${index}`);
        statusElement.className = 'model-status status-error';
        statusElement.textContent = 'Error';
        
        return false;
      }
    }
    
    // Download all models
    async function downloadAllModels() {
      downloadButton.disabled = true;
      progressText.textContent = 'Downloading models...';
      
      let successCount = 0;
      let errorCount = 0;
      
      for (let i = 0; i < models.length; i++) {
        progressText.textContent = `Downloading model ${i + 1} of ${models.length}...`;
        
        const success = await downloadModel(models[i], i);
        
        if (success) {
          successCount++;
        } else {
          errorCount++;
        }
      }
      
      progressText.textContent = `Download complete. ${successCount} models downloaded successfully, ${errorCount} errors.`;
      downloadButton.disabled = false;
      
      if (errorCount > 0) {
        downloadButton.textContent = 'Retry Failed Downloads';
      } else {
        downloadButton.textContent = 'All Models Downloaded';
      }
    }
    
    // Initialize
    initModelList();
    
    // Event listeners
    downloadButton.addEventListener('click', downloadAllModels);
  </script>
</body>
</html>
